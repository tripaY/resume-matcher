import{d as Pe,u as $e,r as g,D as j,G as qe,m as Fe,H as Je,c as n,e as o,g as f,w as i,a as s,n as Ge,p as Ke,y as c,F as k,s as x,C as P,o as t,k as y,i as E,I as re,t as m,A as He,J as ue,z as w,b as U,h as Oe,K as ce,L as _e,_ as We}from"./index-BvEMJiB9.js";const Qe={class:"detail-container"},Xe={key:"loading",class:"loading-state"},Ye={key:"empty",class:"empty-state-container h-full flex items-center justify-center"},Ze={key:"match-content",class:"content-layout"},el={class:"fixed-header"},ll={class:"header-content flex justify-between items-center"},al={class:"scrollable-content"},tl={class:"match-container",style:{"max-width":"1200px",margin:"0 auto"}},sl={key:0,class:"font-bold text-blue-600"},nl={key:0},ol={key:1,class:"text-gray-400 text-xs"},il={class:"pagination mt-4 flex justify-end bg-white p-4"},dl={key:"content",class:"content-layout"},rl={class:"fixed-header"},ul={class:"header-content flex justify-end gap-2"},cl={class:"scrollable-content"},_l={class:"main-layout flex gap-4",style:{display:"flex",gap:"20px","align-items":"flex-start"}},vl={class:"resume-section",style:{flex:"1","min-width":"0"}},pl={class:"resume-info",style:{padding:"20px"}},ml={class:"info-section flex-col",style:{display:"flex","flex-direction":"column",gap:"15px"}},yl={class:"info-row"},fl={class:"value-content"},hl={key:1,class:"text-large font-bold"},gl={class:"info-row"},kl={class:"value-content avatar-section"},xl={key:0,class:"avatar-wrapper"},wl={class:"upload-mask"},bl={key:1,class:"avatar-placeholder"},Vl={class:"info-row"},Cl={class:"value-content"},Ml={key:1},Ul={class:"info-row"},zl={class:"value-content"},jl={key:1},El={class:"info-row"},Sl={class:"value-content"},Dl={key:1},Rl={class:"info-row"},Nl={class:"value-content"},Al={key:0,class:"inline-edit flex items-center",style:{"flex-wrap":"nowrap"}},Bl={key:1},Il={class:"info-row"},Tl={class:"value-content"},Ll={key:0,class:"salary-inputs flex items-center gap-2"},Pl={key:1},$l={class:"skills-section"},ql={key:0},Fl={key:1,class:"min-h-20"},Jl={key:0,class:"text-gray"},Gl={class:"educations-section"},Kl={class:"item-content-group"},Hl={class:"edu-row mb-2"},Ol={class:"w-full"},Wl={key:1,class:"block text-lg mb-1"},Ql={class:"edu-row flex gap-4 items-center"},Xl={class:"flex-1"},Yl={key:1,class:"block text-gray-600"},Zl={key:0,class:"text-gray-300"},ea={class:"flex-1"},la={key:1,class:"block text-gray-600"},aa={class:"experiences-section"},ta={class:"item-content-group"},sa={class:"exp-row mb-2 flex flex-col gap-2"},na={class:"w-full"},oa={key:1,class:"block text-lg mb-1"},ia={class:"w-full"},da={class:"exp-desc mt-2"},ra={key:1,class:"desc whitespace-pre-wrap text-gray-600 leading-relaxed"},ua="https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png",ca=Pe({__name:"ResumeDetail",setup(_a){const N=qe(),J=Oe(),S=$e(),$=g(!0),G=g(!1),A=g(null),b=g(null),Z=g(!1),u=g(!1),K=g(!1),H=g([]),O=g(!1),B=g(1),q=g(10),ee=g(0),_=g(null),h=j(()=>({cities:S.cities||[],levels:S.levels||[],skills:S.skills||[],industries:S.industries||[],degrees:S.degrees||[]})),d=g({candidate_name:"",gender:"M",expected_city_id:null,years_of_experience:0,current_level_id:null,expected_title:"",expected_salary_min:0,expected_salary_max:0,avatar_url:"",avatar_id:null,skill_ids:[],educations:[],experiences:[]}),W=j(()=>N.path==="/my-resume"),le=j(()=>W.value?!0:b.value&&_.value&&b.value.id===_.value.user_id),ve=j(()=>!(!le.value||_.value?.id||Z.value)),ae=j(()=>u.value?fe(d.value.skill_ids):_.value?.skills||[]),te=j(()=>u.value?d.value.educations:_.value?.educations||[]),pe=j(()=>u.value?d.value.experiences:_.value?.experiences||[]),F=()=>Math.random().toString(36).substr(2,9),me=l=>h.value.cities.find(e=>e.id===l)?.name,ye=l=>h.value.degrees.find(e=>e.id===l)?.name,se=l=>h.value.industries.find(e=>e.id===l)?.name,fe=l=>l?l.map(e=>h.value.skills.find(r=>r.id===e)?.name).filter(Boolean):[],he=l=>l>=80?"success":l>=60?"warning":"danger",ne=()=>{K.value=!0,Q()},ge=()=>{K.value=!1;const l={...N.query};delete l.action,J.replace({query:l})},ke=()=>{J.push("/resumes")},xe=()=>{ne()},we=()=>{Z.value=!0,u.value=!0,I()},I=()=>{if(!_.value)return;const l=_.value,e=l.skills?.map(r=>{const p=h.value.skills.find(V=>V.name===r);return p?p.id:null}).filter(Boolean)||[];d.value={id:l.id,candidate_name:l.candidate_name||l.name,gender:l.gender||"M",expected_city_id:h.value.cities.find(r=>r.name===l.expected_city)?.id,years_of_experience:l.years_of_experience||l.years,current_level_id:h.value.levels.find(r=>r.name===l.current_level)?.id,expected_title:l.expected_title,expected_salary_min:l.salary_min,expected_salary_max:l.salary_max,avatar_url:l.avatar_url,avatar_id:l.avatar_id,skill_ids:e,educations:l.educations?.map(r=>({_key:F(),school:r.school,degree_id:r.degree_id||r.degree?.id,major_industry_id:r.major_industry_id||r.major_industry?.id}))||[],experiences:l.experiences?.map(r=>({_key:F(),company_name:r.company_name,industry_id:r.industry_id||r.industry?.id,description:r.description}))||[]}},oe=async()=>{$.value=!0;try{const{data:{user:l}}=await x.getUser();b.value=l,h.value.cities.length||await S.fetchMeta();let e;if(W.value){if(!l)return;e=await x.getMyResume(l.id),e.data?_.value=e.data:_.value={user_id:l.id}}else{const r=Number(N.params.id);r&&(e=await x.getResumeDetail(r),_.value=e.data)}le.value&&I(),$.value=!1}catch(l){console.error(l),$.value=!1}},Q=async()=>{if(_.value?.id){O.value=!0;try{await x.ensureMatchEvaluations(_.value.id);const{data:l,error:e}=await x.getJobsForResume(_.value.id,{page:B.value,pageSize:q.value});if(e)throw e;H.value=l.items,ee.value=l.total,H.value.forEach(async r=>{if(!r.match_info.llm_score)try{const{data:p,error:V}=await x.evaluateMatch(_.value.id,r.id);!V&&p&&(r.match_info.llm_score=p.llm_score,r.match_info.llm_reason=p.llm_reason)}catch(p){console.error("AI evaluation failed for job "+r.id,p)}})}catch(l){P.error("加载匹配数据失败: "+l.message)}finally{O.value=!1}}},ie=l=>{A.value=l},be=()=>{u.value=!1,A.value=null,I()},Ve=async()=>{if(b.value){G.value=!0;try{const{error:l}=await x.saveMyResume(b.value.id,d.value);if(l)throw l;const e=await x.getMyResume(b.value.id);e.data&&(_.value=e.data),setTimeout(()=>{A.value=null,u.value=!1},0)}catch(l){P.error("保存失败: "+l.message)}finally{G.value=!1}}},Ce=()=>{u.value,u.value=!0,I()},Me=l=>{q.value=l,B.value=1,Q()},Ue=l=>{B.value=l,Q()},ze=l=>{J.push({path:`/jobs/${l}`,query:{from:"match",resumeId:_.value?.id}})},je=()=>{const l=F();d.value.educations.push({_key:l,school:"",degree_id:null,major_industry_id:null}),ie(`edu-${l}-school`)},Ee=l=>{setTimeout(()=>{A.value=null},0),d.value.educations.splice(l,1)},Se=()=>{const l=F();d.value.experiences.push({_key:l,company_name:"",industry_id:null,description:""}),ie(`exp-${l}-company`)},De=l=>{setTimeout(()=>{A.value=null},0),d.value.experiences.splice(l,1)},Re=l=>l.type!=="image/jpeg"&&l.type!=="image/png"?(P.error("Avatar picture must be JPG format!"),!1):l.size/1024/1024>2?(P.error("Avatar picture size can not exceed 2MB!"),!1):!0,Ne=async l=>{if(!b.value)return;const{file:e}=l;try{const{url:r,avatarId:p,error:V}=await x.uploadAvatar(b.value.id,e);if(V)throw V;d.value.avatar_url=r,d.value.avatar_id=p}catch(r){P.error("头像上传失败: "+r.message)}};return Fe(async()=>{await oe(),N.query.action==="match"&&ne()}),Je(()=>N.path,()=>{oe()}),(l,e)=>{const r=f("el-skeleton"),p=f("el-button"),V=f("el-empty"),z=f("el-icon"),C=f("el-table-column"),X=f("el-tag"),Ae=f("el-table"),Be=f("el-pagination"),T=f("el-input"),de=f("el-avatar"),Ie=f("el-upload"),D=f("el-option"),R=f("el-select"),Y=f("el-input-number"),L=f("el-divider"),Te=f("el-card"),Le=Ke("loading");return t(),n("div",Qe,[$.value?(t(),n("div",Xe,[o(r,{rows:10,animated:""})])):ve.value?(t(),n("div",Ye,[o(V,{description:"您还没有简历"},{default:i(()=>[o(p,{type:"primary",size:"large",onClick:we},{default:i(()=>[...e[10]||(e[10]=[y("完善简历",-1)])]),_:1})]),_:1})])):K.value?(t(),n("div",Ze,[s("div",el,[s("div",ll,[o(p,{onClick:ge},{default:i(()=>[o(z,{class:"mr-1"},{default:i(()=>[o(E(re))]),_:1}),e[11]||(e[11]=y(" 返回简历详情 ",-1))]),_:1})])]),s("div",al,[s("div",tl,[Ge((t(),c(Ae,{data:H.value,stripe:"",border:""},{default:i(()=>[o(C,{prop:"id",label:"ID",width:"80",align:"center"}),o(C,{prop:"title",label:"岗位名称",width:"200","show-overflow-tooltip":""}),o(C,{label:"匹配度",width:"100",sortable:"",prop:"match_score",align:"center"},{default:i(a=>[o(X,{type:he(a.row.match_score),effect:"dark"},{default:i(()=>[y(m(a.row.match_score),1)]),_:2},1032,["type"])]),_:1}),o(C,{label:"硬性条件得分",width:"120",prop:"match_info.calculate_score",align:"center"},{default:i(a=>[y(m(a.row.match_info.calculate_score),1)]),_:1}),o(C,{label:"硬性条件原因","min-width":"200",prop:"match_info.calculate_reason","show-overflow-tooltip":""}),o(C,{label:"LLM得分",width:"100",prop:"match_info.llm_score",align:"center"},{default:i(a=>[a.row.match_info.llm_score?(t(),n("span",sl,m(a.row.match_info.llm_score),1)):(t(),c(z,{key:1,class:"is-loading"},{default:i(()=>[o(E(He))]),_:1}))]),_:1}),o(C,{label:"LLM分析","min-width":"200",prop:"match_info.llm_reason","show-overflow-tooltip":""},{default:i(a=>[a.row.match_info.llm_reason?(t(),n("span",nl,m(a.row.match_info.llm_reason),1)):(t(),n("span",ol,"正在分析..."))]),_:1}),o(C,{label:"操作",width:"100",fixed:"right",align:"center"},{default:i(a=>[o(p,{type:"primary",link:"",onClick:M=>ze(a.row.id)},{default:i(()=>[...e[12]||(e[12]=[y("查看职位",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Le,O.value]]),s("div",il,[o(Be,{"current-page":B.value,"onUpdate:currentPage":e[0]||(e[0]=a=>B.value=a),"page-size":q.value,"onUpdate:pageSize":e[1]||(e[1]=a=>q.value=a),"page-sizes":[5,10,20],total:ee.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Me,onCurrentChange:Ue},null,8,["current-page","page-size","total"])])])])])):(t(),n("div",dl,[s("div",rl,[s("div",ul,[W.value?(t(),n(k,{key:1},[u.value?(t(),n(k,{key:0},[o(p,{onClick:be},{default:i(()=>[...e[14]||(e[14]=[y("放弃编辑",-1)])]),_:1}),o(p,{type:"primary",onClick:Ve,loading:G.value},{default:i(()=>[...e[15]||(e[15]=[y(" 保存 ",-1)])]),_:1},8,["loading"])],64)):(t(),n(k,{key:1},[o(p,{onClick:Ce},{default:i(()=>[...e[16]||(e[16]=[y(" 去编辑 ",-1)])]),_:1}),o(p,{type:"success",onClick:xe},{default:i(()=>[...e[17]||(e[17]=[y(" 智能匹配 ",-1)])]),_:1})],64))],64)):(t(),c(p,{key:0,onClick:ke},{default:i(()=>[o(z,{class:"mr-1"},{default:i(()=>[o(E(re))]),_:1}),e[13]||(e[13]=y(" 返回列表 ",-1))]),_:1}))])]),s("div",cl,[s("div",_l,[s("div",vl,[o(Te,{class:"box-card resume-card",shadow:"never","body-style":{padding:"0px"}},{default:i(()=>[s("div",pl,[s("div",ml,[s("div",yl,[e[18]||(e[18]=s("span",{class:"label"},"姓名:",-1)),s("div",fl,[u.value?(t(),c(T,{key:0,modelValue:d.value.candidate_name,"onUpdate:modelValue":e[2]||(e[2]=a=>d.value.candidate_name=a),placeholder:"姓名"},null,8,["modelValue"])):(t(),n("span",hl,m(d.value.candidate_name||_.value?.candidate_name||"您的姓名"),1))])]),s("div",gl,[e[20]||(e[20]=s("span",{class:"label"},"头像:",-1)),s("div",kl,[u.value?(t(),c(Ie,{key:0,class:"avatar-uploader",action:"#","show-file-list":!1,"http-request":Ne,"before-upload":Re},{default:i(()=>[d.value.avatar_url||_.value?.avatar_url?(t(),n("div",xl,[o(de,{size:100,src:d.value.avatar_url||_.value?.avatar_url},null,8,["src"]),s("div",wl,[o(z,null,{default:i(()=>[o(E(ue))]),_:1})])])):(t(),n("div",bl,[o(z,{class:"avatar-uploader-icon"},{default:i(()=>[o(E(ue))]),_:1}),e[19]||(e[19]=s("span",null,"上传头像",-1))]))]),_:1})):(t(),c(de,{key:1,size:100,src:_.value?.avatar_url||ua},null,8,["src"]))])]),s("div",Vl,[e[21]||(e[21]=s("span",{class:"label"},"当前职级:",-1)),s("div",Cl,[u.value?(t(),c(R,{key:0,modelValue:d.value.current_level_id,"onUpdate:modelValue":e[3]||(e[3]=a=>d.value.current_level_id=a),placeholder:"当前职级",style:{width:"100%"}},{default:i(()=>[(t(!0),n(k,null,w(h.value.levels,a=>(t(),c(D,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):(t(),n("span",Ml,m(_.value?.current_level||"未设置"),1))])]),s("div",Ul,[e[22]||(e[22]=s("span",{class:"label"},"期望职位:",-1)),s("div",zl,[u.value?(t(),c(T,{key:0,modelValue:d.value.expected_title,"onUpdate:modelValue":e[4]||(e[4]=a=>d.value.expected_title=a),placeholder:"期望职位 (如: 前端开发工程师)"},null,8,["modelValue"])):(t(),n("span",jl,m(d.value.expected_title||_.value?.expected_title||"未设置"),1))])]),s("div",El,[e[23]||(e[23]=s("span",{class:"label"},"期望城市:",-1)),s("div",Sl,[u.value?(t(),c(R,{key:0,modelValue:d.value.expected_city_id,"onUpdate:modelValue":e[5]||(e[5]=a=>d.value.expected_city_id=a),placeholder:"期望城市",style:{width:"100%"}},{default:i(()=>[(t(!0),n(k,null,w(h.value.cities,a=>(t(),c(D,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):(t(),n("span",Dl,m(me(d.value.expected_city_id)||_.value?.expected_city||"未设置"),1))])]),s("div",Rl,[e[25]||(e[25]=s("span",{class:"label"},"工作经验:",-1)),s("div",Nl,[u.value?(t(),n("div",Al,[o(Y,{modelValue:d.value.years_of_experience,"onUpdate:modelValue":e[6]||(e[6]=a=>d.value.years_of_experience=a),min:0,"controls-position":"right",style:{width:"100%"}},null,8,["modelValue"]),e[24]||(e[24]=s("span",{class:"ml-2 whitespace-nowrap"},"年",-1))])):(t(),n("span",Bl,m(_.value?.years_of_experience)+" 年",1))])]),s("div",Il,[e[27]||(e[27]=s("span",{class:"label"},"期望薪资:",-1)),s("div",Tl,[u.value?(t(),n("div",Ll,[o(Y,{modelValue:d.value.expected_salary_min,"onUpdate:modelValue":e[7]||(e[7]=a=>d.value.expected_salary_min=a),min:0,placeholder:"Min",step:1e3,style:{width:"100%"}},null,8,["modelValue"]),e[26]||(e[26]=s("span",{class:"separator"},"-",-1)),o(Y,{modelValue:d.value.expected_salary_max,"onUpdate:modelValue":e[8]||(e[8]=a=>d.value.expected_salary_max=a),min:0,placeholder:"Max",step:1e3,style:{width:"100%"}},null,8,["modelValue"])])):(t(),n("span",Pl,m(_.value?.salary_min)+" - "+m(_.value?.salary_max),1))])])])]),o(L,null,{default:i(()=>[...e[28]||(e[28]=[y("技能栈",-1)])]),_:1}),s("div",$l,[u.value?(t(),n("div",ql,[o(R,{modelValue:d.value.skill_ids,"onUpdate:modelValue":e[9]||(e[9]=a=>d.value.skill_ids=a),multiple:"",filterable:"",placeholder:"选择技能",class:"w-100"},{default:i(()=>[(t(!0),n(k,null,w(h.value.skills,a=>(t(),c(D,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])):(t(),n("div",Fl,[(t(!0),n(k,null,w(ae.value,a=>(t(),c(X,{key:a,class:"mr-2 mb-2"},{default:i(()=>[y(m(a),1)]),_:2},1024))),128)),ae.value?.length?U("",!0):(t(),n("span",Jl,"暂无技能"))]))]),o(L,null,{default:i(()=>[...e[29]||(e[29]=[y("教育背景",-1)])]),_:1}),s("div",Gl,[(t(!0),n(k,null,w(te.value,(a,M)=>(t(),n("div",{key:a._key||M,class:"edu-item-wrapper relative group"},[s("div",Kl,[u.value?(t(),c(p,{key:0,class:"delete-btn",type:"danger",circle:"",size:"small",onClick:ce(v=>Ee(M),["stop"])},{default:i(()=>[o(z,null,{default:i(()=>[o(E(_e))]),_:1})]),_:1},8,["onClick"])):U("",!0),s("div",Hl,[s("div",Ol,[u.value?(t(),c(T,{key:0,modelValue:a.school,"onUpdate:modelValue":v=>a.school=v,placeholder:"学校名称"},null,8,["modelValue","onUpdate:modelValue"])):(t(),n("strong",Wl,m(a.school||"学校名称"),1))])]),s("div",Ql,[s("div",Xl,[u.value?(t(),c(R,{key:0,modelValue:a.degree_id,"onUpdate:modelValue":v=>a.degree_id=v,placeholder:"学历",size:"default",style:{width:"100%"}},{default:i(()=>[(t(!0),n(k,null,w(h.value.degrees,v=>(t(),c(D,{key:v.id,label:v.name,value:v.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue"])):(t(),n("span",Yl,m(a.degree?.name||ye(a.degree_id)||"学历"),1))]),u.value?U("",!0):(t(),n("span",Zl,"|")),s("div",ea,[u.value?(t(),c(R,{key:0,modelValue:a.major_industry_id,"onUpdate:modelValue":v=>a.major_industry_id=v,placeholder:"专业方向",size:"default",style:{width:"100%"}},{default:i(()=>[(t(!0),n(k,null,w(h.value.industries,v=>(t(),c(D,{key:v.id,label:v.name,value:v.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue"])):(t(),n("span",la,m(a.major_industry?.name||se(a.major_industry_id)||"相关专业"),1))])])]),M<te.value.length-1?(t(),c(L,{key:0,"border-style":"dashed"})):U("",!0)]))),128)),u.value?(t(),c(p,{key:0,class:"mt-4 w-100 dashed-btn",onClick:je},{default:i(()=>[...e[30]||(e[30]=[y("+ 添加教育经历",-1)])]),_:1})):U("",!0)]),o(L,null,{default:i(()=>[...e[31]||(e[31]=[y("工作经历",-1)])]),_:1}),s("div",aa,[(t(!0),n(k,null,w(pe.value,(a,M)=>(t(),n("div",{key:a._key||M,class:"exp-item-wrapper relative group"},[s("div",ta,[u.value?(t(),c(p,{key:0,class:"delete-btn",type:"danger",circle:"",size:"small",onClick:ce(v=>De(M),["stop"])},{default:i(()=>[o(z,null,{default:i(()=>[o(E(_e))]),_:1})]),_:1},8,["onClick"])):U("",!0),s("div",sa,[s("div",na,[u.value?(t(),c(T,{key:0,modelValue:a.company_name,"onUpdate:modelValue":v=>a.company_name=v,placeholder:"公司名称",class:"mb-2"},null,8,["modelValue","onUpdate:modelValue"])):(t(),n("strong",oa,m(a.company_name||"公司名称"),1))]),s("div",ia,[u.value?(t(),c(R,{key:0,modelValue:a.industry_id,"onUpdate:modelValue":v=>a.industry_id=v,placeholder:"行业",size:"default",style:{width:"100%"}},{default:i(()=>[(t(!0),n(k,null,w(h.value.industries,v=>(t(),c(D,{key:v.id,label:v.name,value:v.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue"])):(t(),c(X,{key:1,size:"small",type:"info"},{default:i(()=>[y(m(a.industry?.name||se(a.industry_id)||"行业"),1)]),_:2},1024))])]),s("div",da,[u.value?(t(),c(T,{key:0,modelValue:a.description,"onUpdate:modelValue":v=>a.description=v,type:"textarea",rows:3,placeholder:"工作描述"},null,8,["modelValue","onUpdate:modelValue"])):(t(),n("p",ra,m(a.description||"工作描述..."),1))])]),M<d.value.experiences.length-1?(t(),c(L,{key:0,"border-style":"dashed"})):U("",!0)]))),128)),u.value?(t(),c(p,{key:0,class:"mt-4 w-100 dashed-btn",onClick:Se},{default:i(()=>[...e[32]||(e[32]=[y("+ 添加工作经历",-1)])]),_:1})):U("",!0)])]),_:1})])])])]))])}}}),pa=We(ca,[["__scopeId","data-v-75e91bb1"]]);export{pa as default};
