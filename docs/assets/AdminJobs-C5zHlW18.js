import{d as ge,u as be,r as f,x as Z,m as we,c as d,e as a,a as c,n as ee,w as t,g as p,p as ke,y as g,t as k,s as x,o as r,k as y,F as h,z as V,i as b,A as he,h as Ve,B as le,E as xe,C as M,_ as Ce}from"./index-BvEMJiB9.js";const qe={class:"page-container"},Ue={key:0},ze={class:"header-actions mb-4 flex justify-between"},Se={class:"filter-bar"},Me={class:"pagination"},Ee={key:1},De={class:"header-actions mb-4 flex justify-between items-center"},Je={class:"flex items-center gap-4"},Be={class:"m-0"},$e={class:"font-bold"},Le={class:"font-bold"},je=["title"],Te={key:0},Fe={key:1,class:"text-gray-400"},Ie={key:0},Re=["title"],Ae={key:1,class:"text-gray-400 italic"},Ne={key:2},Pe={class:"flex items-center gap-2"},Oe={class:"dialog-footer"},Ge=ge({__name:"AdminJobs",setup(He){const A=Ve(),w=be(),L=f(!1),N=f([]),P=f(0),C=f(1),B=f(20),j=f(!1),E=f([]),q=f(null),U=f(!1),D=f(!1),T=f(!1),J=f(),n=f({}),ae=Z({title:[{required:!0,message:"请输入职位名称",trigger:"blur"}],city_id:[{required:!0,message:"请选择城市",trigger:"change"}],level_id:[{required:!0,message:"请选择职级要求",trigger:"change"}],degree_required_id:[{required:!0,message:"请选择最低学历",trigger:"change"}],industry_id:[{required:!0,message:"请选择所属行业",trigger:"change"}],min_years:[{required:!0,message:"请输入工作年限",trigger:"blur"}],salary_min:[{required:!0,message:"请输入最低薪资",trigger:"blur"}],salary_max:[{required:!0,message:"请输入最高薪资",trigger:"blur"},{validator:(i,l,o)=>{l<n.value.salary_min?o(new Error("最高薪资不能低于最低薪资")):o()},trigger:"blur"}],description:[{required:!0,message:"请输入职位描述",trigger:"blur"}]}),_=Z({city:"",level:"",skill:"",industry:"",degree:"",min_years:void 0}),z=async()=>{L.value=!0;try{const i={..._,page:C.value,pageSize:B.value};Object.keys(i).forEach(o=>{(i[o]===""||i[o]===void 0)&&delete i[o]});const l=await x.getJobs(i);if(l.error){console.error(l.error);return}N.value=l.data.items,P.value=l.data.total}catch(i){console.error(i)}finally{L.value=!1}},O=()=>{C.value=1,z()},te=()=>{_.city="",_.level="",_.skill="",_.industry="",_.degree="",_.min_years=void 0,O()},ie=i=>{C.value=i,z()},re=i=>{B.value=i,C.value=1,z()},ne=i=>{A.push(`/jobs/${i}`)},oe=async()=>{D.value=!1,n.value={title:"",city_id:null,min_years:0,level_id:null,degree_required_id:null,industry_id:null,salary_min:0,salary_max:0,description:"",required_skill_ids:[],nice_skill_ids:[]},U.value=!0,await le(),J.value?.clearValidate()},se=async i=>{D.value=!0,n.value={id:i.id,title:i.title,city_id:i.city_id,min_years:i.min_years,level_id:i.level_id,degree_required_id:i.degree_required_id,industry_id:i.industry_id,salary_min:i.salary_min,salary_max:i.salary_max,description:i.description,required_skill_ids:i.required_skill_ids||[],nice_skill_ids:i.nice_skill_ids||[]},U.value=!0,await le(),J.value?.clearValidate()},de=async i=>{try{await xe.confirm("确定要删除该职位吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const{error:l}=await x.deleteJob(i.id);if(l)throw l;M.success("删除成功"),z()}catch(l){l!=="cancel"&&M.error("删除失败: "+(l.message||l))}},ue=async()=>{if(J.value){try{await J.value.validate()}catch{M.warning("请检查表单填写是否完整");return}T.value=!0;try{const i={...n.value},{data:{user:l}}=await x.getUser();l&&(i.user_id=l.id);let o;if(D.value?(delete i.id,o=await x.updateJob(n.value.id,i)):o=await x.createJob(i),o.error)throw o.error;M.success(D.value?"更新成功":"发布成功"),U.value=!1,z()}catch(i){console.error(i),M.error("保存失败: "+(i.message||i))}finally{T.value=!1}}},G=i=>i>=80?"success":i>=60?"warning":"exception",F=f(!1),H=f(""),_e=async i=>{q.value=i.id,H.value=i.title,F.value=!0,E.value=[],await ce()},me=()=>{F.value=!1,E.value=[],q.value=null},ce=async()=>{if(q.value){j.value=!0;try{const{error:i}=await x.ensureJobMatchEvaluations(q.value);if(i)throw i;const{data:l,error:o}=await x.getResumesForJob(q.value,{page:1,pageSize:20});if(o)throw o;E.value=l.items,E.value.forEach(async m=>{if(m.match_info.llm_score===null||m.match_info.llm_score===void 0)try{const{data:u,error:s}=await x.evaluateMatch(m.id,q.value);!s&&u&&u.success&&(m.match_info.llm_score=u.score,m.match_info.llm_reason=u.reason)}catch(u){console.error(u)}})}catch(i){M.error("获取匹配失败: "+(i.message||i))}finally{j.value=!1}}};return we(()=>{w.fetchMeta(),z()}),(i,l)=>{const o=p("el-button"),m=p("el-option"),u=p("el-select"),s=p("el-form-item"),K=p("el-form"),v=p("el-table-column"),Q=p("el-tag"),W=p("el-table"),pe=p("el-pagination"),ve=p("el-progress"),fe=p("el-icon"),X=p("el-input"),S=p("el-col"),I=p("el-row"),R=p("el-input-number"),ye=p("el-dialog"),Y=ke("loading");return r(),d("div",qe,[F.value?(r(),d("div",Ee,[c("div",De,[c("div",Je,[a(o,{icon:"Back",circle:"",onClick:me}),c("h2",Be,"智能匹配结果: "+k(H.value),1)])]),ee((r(),g(W,{data:E.value,style:{width:"100%"},stripe:"",border:""},{default:t(()=>[a(v,{prop:"id",label:"ID",width:"80",align:"center"}),a(v,{prop:"candidate_name",label:"候选人名称",width:"120"},{default:t(e=>[c("div",$e,k(e.row.candidate_name),1)]),_:1}),a(v,{label:"匹配度",width:"100",align:"center"},{default:t(e=>[a(ve,{type:"circle",percentage:e.row.match_info?.score||0,width:50,status:G(e.row.match_info?.score||0)},null,8,["percentage","status"])]),_:1}),a(v,{label:"硬性条件得分",width:"120",align:"center"},{default:t(e=>[c("span",Le,k(e.row.match_info?.calculate_score||0),1)]),_:1}),a(v,{label:"硬性条件原因","min-width":"200"},{default:t(e=>[c("div",{class:"text-sm text-gray-600 line-clamp-3",title:e.row.match_info?.calculate_reason},k(e.row.match_info?.calculate_reason||"-"),9,je)]),_:1}),a(v,{label:"LLM得分",width:"100",align:"center"},{default:t(e=>[e.row.match_info?.llm_score!==void 0?(r(),d("div",Te,[a(Q,{size:"small",effect:"dark",type:G(e.row.match_info.llm_score)},{default:t(()=>[y(k(e.row.match_info.llm_score),1)]),_:2},1032,["type"])])):(r(),d("div",Fe," - "))]),_:1}),a(v,{label:"LLM分析","min-width":"300"},{default:t(e=>[e.row.match_info?.llm_reason?(r(),d("div",Ie,[c("div",{class:"text-sm text-gray-600 leading-relaxed line-clamp-3",title:e.row.match_info.llm_reason},k(e.row.match_info.llm_reason),9,Re)])):e.row.match_info?.llm_score===void 0?(r(),d("div",Ae,[a(fe,{class:"is-loading"},{default:t(()=>[a(b(he))]),_:1}),l[27]||(l[27]=y(" 分析中... ",-1))])):(r(),d("div",Ne," - "))]),_:1}),a(v,{label:"操作",width:"120",fixed:"right"},{default:t(e=>[a(o,{type:"primary",link:"",onClick:$=>b(A).push(`/resumes/${e.row.id}`)},{default:t(()=>[...l[28]||(l[28]=[y(" 查看详情 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Y,j.value]])])):(r(),d("div",Ue,[c("div",ze,[l[20]||(l[20]=c("h2",null,"岗位管理",-1)),a(o,{type:"primary",onClick:oe},{default:t(()=>[...l[19]||(l[19]=[y("发布职位",-1)])]),_:1})]),c("div",Se,[a(K,{inline:!0,model:_,class:"demo-form-inline"},{default:t(()=>[a(s,{label:"城市"},{default:t(()=>[a(u,{modelValue:_.city,"onUpdate:modelValue":l[0]||(l[0]=e=>_.city=e),placeholder:"选择城市",clearable:""},{default:t(()=>[(r(!0),d(h,null,V(b(w).cities,e=>(r(),g(m,{key:e.id,label:e.name,value:e.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(s,{label:"职级"},{default:t(()=>[a(u,{modelValue:_.level,"onUpdate:modelValue":l[1]||(l[1]=e=>_.level=e),placeholder:"选择职级",clearable:""},{default:t(()=>[(r(!0),d(h,null,V(b(w).levels,e=>(r(),g(m,{key:e.id,label:e.name,value:e.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(s,{label:"技能"},{default:t(()=>[a(u,{modelValue:_.skill,"onUpdate:modelValue":l[2]||(l[2]=e=>_.skill=e),placeholder:"要求技能",clearable:""},{default:t(()=>[(r(!0),d(h,null,V(b(w).skills,e=>(r(),g(m,{key:e.id,label:e.name,value:e.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(s,{label:"行业"},{default:t(()=>[a(u,{modelValue:_.industry,"onUpdate:modelValue":l[3]||(l[3]=e=>_.industry=e),placeholder:"所属行业",clearable:""},{default:t(()=>[(r(!0),d(h,null,V(b(w).industries,e=>(r(),g(m,{key:e.id,label:e.name,value:e.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(s,null,{default:t(()=>[a(o,{type:"primary",onClick:O},{default:t(()=>[...l[21]||(l[21]=[y("筛选",-1)])]),_:1}),a(o,{onClick:te},{default:t(()=>[...l[22]||(l[22]=[y("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),ee((r(),g(W,{data:N.value,style:{width:"100%"},stripe:""},{default:t(()=>[a(v,{prop:"id",label:"ID",width:"80"}),a(v,{prop:"title",label:"职位名称",width:"180"}),a(v,{prop:"city",label:"城市",width:"100"}),a(v,{prop:"min_years",label:"最低年限",width:"100"},{default:t(e=>[y(k(e.row.min_years)+"年 ",1)]),_:1}),a(v,{prop:"level",label:"职级",width:"100"},{default:t(e=>[a(Q,{type:"success"},{default:t(()=>[y(k(e.row.level),1)]),_:2},1024)]),_:1}),a(v,{label:"薪资范围",width:"150"},{default:t(e=>[y(k(e.row.salary_min)+" - "+k(e.row.salary_max),1)]),_:1}),a(v,{label:"操作",width:"250",fixed:"right"},{default:t(e=>[a(o,{size:"small",onClick:$=>ne(e.row.id)},{default:t(()=>[...l[23]||(l[23]=[y("查看",-1)])]),_:1},8,["onClick"]),a(o,{type:"success",size:"small",onClick:$=>_e(e.row)},{default:t(()=>[...l[24]||(l[24]=[y("智能匹配",-1)])]),_:1},8,["onClick"]),a(o,{type:"primary",size:"small",onClick:$=>se(e.row)},{default:t(()=>[...l[25]||(l[25]=[y("编辑",-1)])]),_:1},8,["onClick"]),a(o,{type:"danger",size:"small",onClick:$=>de(e.row)},{default:t(()=>[...l[26]||(l[26]=[y("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Y,L.value]]),c("div",Me,[a(pe,{"current-page":C.value,"onUpdate:currentPage":l[4]||(l[4]=e=>C.value=e),"page-size":B.value,"onUpdate:pageSize":l[5]||(l[5]=e=>B.value=e),"page-sizes":[5,10,20],total:P.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:re,onCurrentChange:ie},null,8,["current-page","page-size","total"])])])),a(ye,{modelValue:U.value,"onUpdate:modelValue":l[18]||(l[18]=e=>U.value=e),title:D.value?"编辑职位":"发布职位",width:"60%"},{footer:t(()=>[c("span",Oe,[a(o,{onClick:l[17]||(l[17]=e=>U.value=!1)},{default:t(()=>[...l[32]||(l[32]=[y("取消",-1)])]),_:1}),a(o,{type:"primary",onClick:ue,loading:T.value},{default:t(()=>[...l[33]||(l[33]=[y("保存",-1)])]),_:1},8,["loading"])])]),default:t(()=>[a(K,{ref_key:"formRef",ref:J,model:n.value,rules:ae,"label-width":"100px"},{default:t(()=>[a(I,{gutter:20},{default:t(()=>[a(S,{span:12},{default:t(()=>[a(s,{label:"职位名称",prop:"title"},{default:t(()=>[a(X,{modelValue:n.value.title,"onUpdate:modelValue":l[6]||(l[6]=e=>n.value.title=e),placeholder:"例如: 高级前端工程师"},null,8,["modelValue"])]),_:1})]),_:1}),a(S,{span:12},{default:t(()=>[a(s,{label:"城市",prop:"city_id"},{default:t(()=>[a(u,{modelValue:n.value.city_id,"onUpdate:modelValue":l[7]||(l[7]=e=>n.value.city_id=e),placeholder:"选择城市",style:{width:"100%"}},{default:t(()=>[(r(!0),d(h,null,V(b(w).cities,e=>(r(),g(m,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(I,{gutter:20},{default:t(()=>[a(S,{span:12},{default:t(()=>[a(s,{label:"职级要求",prop:"level_id"},{default:t(()=>[a(u,{modelValue:n.value.level_id,"onUpdate:modelValue":l[8]||(l[8]=e=>n.value.level_id=e),placeholder:"选择职级",style:{width:"100%"}},{default:t(()=>[(r(!0),d(h,null,V(b(w).levels,e=>(r(),g(m,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(S,{span:12},{default:t(()=>[a(s,{label:"最低学历",prop:"degree_required_id"},{default:t(()=>[a(u,{modelValue:n.value.degree_required_id,"onUpdate:modelValue":l[9]||(l[9]=e=>n.value.degree_required_id=e),placeholder:"学历要求",style:{width:"100%"}},{default:t(()=>[(r(!0),d(h,null,V(b(w).degrees,e=>(r(),g(m,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(I,{gutter:20},{default:t(()=>[a(S,{span:12},{default:t(()=>[a(s,{label:"所属行业",prop:"industry_id"},{default:t(()=>[a(u,{modelValue:n.value.industry_id,"onUpdate:modelValue":l[10]||(l[10]=e=>n.value.industry_id=e),placeholder:"选择行业",style:{width:"100%"}},{default:t(()=>[(r(!0),d(h,null,V(b(w).industries,e=>(r(),g(m,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(S,{span:12},{default:t(()=>[a(s,{label:"工作年限",prop:"min_years"},{default:t(()=>[a(R,{modelValue:n.value.min_years,"onUpdate:modelValue":l[11]||(l[11]=e=>n.value.min_years=e),min:0,max:20,label:"最低年限"},null,8,["modelValue"]),l[29]||(l[29]=c("span",{class:"ml-2"},"年以上",-1))]),_:1})]),_:1})]),_:1}),a(s,{label:"薪资范围",required:""},{default:t(()=>[c("div",Pe,[a(s,{prop:"salary_min",style:{"margin-bottom":"0"}},{default:t(()=>[a(R,{modelValue:n.value.salary_min,"onUpdate:modelValue":l[12]||(l[12]=e=>n.value.salary_min=e),min:0,step:1e3,placeholder:"最低",style:{width:"160px"}},null,8,["modelValue"])]),_:1}),l[30]||(l[30]=c("span",null,"-",-1)),a(s,{prop:"salary_max",style:{"margin-bottom":"0"}},{default:t(()=>[a(R,{modelValue:n.value.salary_max,"onUpdate:modelValue":l[13]||(l[13]=e=>n.value.salary_max=e),min:0,step:1e3,placeholder:"最高",style:{width:"160px"}},null,8,["modelValue"])]),_:1}),l[31]||(l[31]=c("span",{class:"ml-2 text-gray-500"},"元/月",-1))])]),_:1}),a(s,{label:"必备技能",prop:"required_skill_ids"},{default:t(()=>[a(u,{modelValue:n.value.required_skill_ids,"onUpdate:modelValue":l[14]||(l[14]=e=>n.value.required_skill_ids=e),multiple:"",filterable:"",placeholder:"选择必须具备的技能",style:{width:"100%"}},{default:t(()=>[(r(!0),d(h,null,V(b(w).skills,e=>(r(),g(m,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(s,{label:"加分技能",prop:"nice_skill_ids"},{default:t(()=>[a(u,{modelValue:n.value.nice_skill_ids,"onUpdate:modelValue":l[15]||(l[15]=e=>n.value.nice_skill_ids=e),multiple:"",filterable:"",placeholder:"选择加分项技能",style:{width:"100%"}},{default:t(()=>[(r(!0),d(h,null,V(b(w).skills,e=>(r(),g(m,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(s,{label:"职位描述",prop:"description"},{default:t(()=>[a(X,{modelValue:n.value.description,"onUpdate:modelValue":l[16]||(l[16]=e=>n.value.description=e),type:"textarea",rows:6,placeholder:"请输入详细的职位描述和任职要求..."},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}}),We=Ce(Ge,[["__scopeId","data-v-1d4ccdb7"]]);export{We as default};
