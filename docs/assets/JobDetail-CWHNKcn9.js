import{d as ne,G as re,u as de,r as y,x as ue,m as _e,s as x,c as n,e as t,g as u,a as r,b as V,w as o,F as p,M as H,n as ce,p as me,y as c,z as h,C as J,o as i,k as _,i as f,N as ve,t as d,O as ye,P as pe,Q as fe,h as ge,R as ke,_ as he}from"./index-CjC9TpiK.js";const be={class:"detail-container"},xe={key:0,class:"loading-state"},we={key:1,class:"content-layout"},Ve={class:"fixed-header"},qe={class:"header-inner"},Ce={class:"header-left"},Me={key:0,class:"header-right"},Ue={class:"scrollable-content"},Ne={class:"job-section"},De={class:"job-header-info"},Se={class:"title-row"},Je={key:1,class:"page-title"},ze={key:2,class:"tags-row"},Ee={key:0,class:"edit-meta-grid mt-4"},je={class:"flex gap-2"},Be={key:1,class:"meta-info-grid mt-6"},Re={class:"info-item"},$e={class:"info-item"},Ie={class:"info-item"},Fe={class:"section-block"},Oe={key:0},Le={key:1,class:"tags-wrapper"},Ae={key:0,class:"text-gray-400"},Ge={class:"section-block mt-6"},Pe={key:0},Qe={key:1,class:"tags-wrapper"},Te={key:0,class:"text-gray-400"},He={class:"section-block"},Ke={key:1,class:"desc-content whitespace-pre-wrap leading-relaxed text-gray-700"},We={key:0,class:"matches-sidebar"},Xe={class:"sidebar-header"},Ye={class:"match-list-container"},Ze={key:1,class:"match-cards"},el={class:"match-card-header flex justify-between items-start"},ll={class:"candidate-basic"},sl={class:"font-bold text-lg"},tl={class:"text-xs text-gray-500 mt-1"},al={class:"match-reasons mt-3"},il={key:0,class:"reason-text text-xs text-gray-600 line-clamp-3"},ol={key:1,class:"reason-text text-xs text-gray-600 line-clamp-3"},nl={class:"card-actions mt-3 pt-3 border-t border-gray-100 text-right"},rl=ne({__name:"JobDetail",setup(dl){const z=re(),O=ge(),q=Number(z.params.id),w=de(),j=y(!0),B=y(!1),m=y(!1),b=y(!1),R=y(!1),$=y(!1),I=y(!1),K=y(null),e=ue({id:0,title:"",city:"",city_id:null,level:"",level_id:null,salary_min:0,salary_max:0,min_years:0,degree_required:"",degree_required_id:null,required_skills:[],required_skill_ids:[],nice_to_have_skills:[],nice_skill_ids:[],description:""}),F=y(null),C=y([]),W=a=>a>=80?"score-high":a>=60?"score-mid":"score-low",X=()=>{z.query.from==="match"&&z.query.resumeId?O.push({path:`/resumes/${z.query.resumeId}`,query:{action:"match"}}):O.back()},L=async()=>{j.value=!0;try{const a=await x.getJobDetail(q);a.data&&(F.value=JSON.parse(JSON.stringify(a.data)),A(a.data))}catch(a){console.error(a),J.error("加载岗位详情失败")}finally{j.value=!1}},A=a=>{e.id=a.id,e.title=a.title,e.city=a.city,e.city_id=a.city_id,e.level=a.level,e.level_id=a.level_id,e.salary_min=a.salary_min,e.salary_max=a.salary_max,e.min_years=a.min_years,e.degree_required=a.degree_required,e.degree_required_id=a.degree_required_id,e.required_skills=[...a.required_skills||[]],e.required_skill_ids=[...a.required_skill_ids||[]],e.nice_to_have_skills=[...a.nice_to_have_skills||[]],e.nice_skill_ids=[...a.nice_skill_ids||[]],e.description=a.description},Y=()=>{m.value=!0,b.value=!1},Z=()=>{m.value=!1,F.value&&A(F.value)},ee=async()=>{B.value=!0;try{const a={title:e.title,city_id:e.city_id,level_id:e.level_id,salary_min:Number(e.salary_min),salary_max:Number(e.salary_max),min_years:Number(e.min_years),degree_required_id:e.degree_required_id,required_skill_ids:e.required_skill_ids,nice_skill_ids:e.nice_skill_ids,description:e.description},{error:s}=await x.updateJob(q,a);if(s)throw s;J.success("保存成功"),m.value=!1,await L()}catch(a){console.error(a),J.error("保存失败")}finally{B.value=!1}},le=()=>{b.value=!b.value,b.value&&C.value.length===0&&G()},G=async()=>{R.value=!0;try{const a=await x.getJobMatches(q);a.data&&(C.value=a.data,C.value.forEach(async s=>{if(s.llm_score===null||s.llm_score===void 0)try{const{data:v,error:g}=await x.evaluateMatch(s.resume.id,q);!g&&v&&v.success&&(s.llm_score=v.score,s.llm_reason=v.reason)}catch{}}))}catch(a){console.error(a)}finally{R.value=!1}},se=async()=>{$.value=!0;try{const{data:a}=await x.getResumes({page:1,pageSize:100}),s=a.items;let v=0;for(const g of s){const{error:k}=await x.evaluateMatch(g.id,q);k||v++}J.success(`重新计算完成，处理 ${v} 份简历`),G()}catch{J.error("匹配计算失败")}finally{$.value=!1}};return _e(async()=>{w.fetchMeta();const{data:{user:a}}=await x.getUser();a&&(K.value=a,a.user_metadata?.role==="admin"&&(I.value=!0)),L()}),(a,s)=>{const v=u("el-skeleton"),g=u("el-icon"),k=u("el-button"),E=u("el-input"),M=u("el-tag"),U=u("el-option"),N=u("el-select"),D=u("el-form-item"),S=u("el-col"),P=u("el-row"),te=u("el-input-number"),ae=u("el-form"),Q=u("el-divider"),T=u("el-card"),ie=u("el-empty"),oe=me("loading");return i(),n("div",be,[j.value?(i(),n("div",xe,[t(v,{rows:10,animated:""})])):(i(),n("div",we,[r("div",Ve,[r("div",qe,[r("div",Ce,[t(k,{onClick:X},{default:o(()=>[t(g,{class:"mr-1"},{default:o(()=>[t(f(ve))]),_:1}),s[10]||(s[10]=_(" 返回列表 ",-1))]),_:1})]),I.value?(i(),n("div",Me,[m.value?(i(),n(p,{key:0},[t(k,{onClick:Z},{default:o(()=>[...s[11]||(s[11]=[_("放弃编辑",-1)])]),_:1}),t(k,{type:"primary",onClick:ee,loading:B.value},{default:o(()=>[...s[12]||(s[12]=[_("保存",-1)])]),_:1},8,["loading"])],64)):(i(),n(p,{key:1},[t(k,{onClick:Y},{default:o(()=>[...s[13]||(s[13]=[_("编辑岗位",-1)])]),_:1}),t(k,{type:"success",onClick:le},{default:o(()=>[_(d(b.value?"隐藏匹配":"智能匹配"),1)]),_:1})],64))])):V("",!0)])]),r("div",Ue,[r("div",{class:H(["main-layout",{"has-sidebar":b.value}])},[r("div",Ne,[t(T,{class:"box-card job-card",shadow:"never"},{default:o(()=>[r("div",De,[r("div",Se,[m.value?(i(),c(E,{key:0,modelValue:e.title,"onUpdate:modelValue":s[0]||(s[0]=l=>e.title=l),placeholder:"职位名称",class:"title-input mb-4"},null,8,["modelValue"])):(i(),n("h1",Je,d(e.title),1)),m.value?V("",!0):(i(),n("div",ze,[t(M,{type:"success",class:"mr-2"},{default:o(()=>[_(d(e.level),1)]),_:1}),t(M,{type:"warning",effect:"plain"},{default:o(()=>[_(d(e.salary_min)+" - "+d(e.salary_max),1)]),_:1}),t(M,{type:"info",class:"ml-2"},{default:o(()=>[_(d(e.city),1)]),_:1})]))]),m.value?(i(),n("div",Ee,[t(ae,{"label-position":"top"},{default:o(()=>[t(P,{gutter:20},{default:o(()=>[t(S,{span:8},{default:o(()=>[t(D,{label:"职级"},{default:o(()=>[t(N,{modelValue:e.level_id,"onUpdate:modelValue":s[1]||(s[1]=l=>e.level_id=l),placeholder:"选择职级",style:{width:"100%"}},{default:o(()=>[(i(!0),n(p,null,h(f(w).levels,l=>(i(),c(U,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(S,{span:8},{default:o(()=>[t(D,{label:"薪资范围"},{default:o(()=>[r("div",je,[t(E,{modelValue:e.salary_min,"onUpdate:modelValue":s[2]||(s[2]=l=>e.salary_min=l),placeholder:"Min"},null,8,["modelValue"]),s[14]||(s[14]=r("span",{class:"sep"},"-",-1)),t(E,{modelValue:e.salary_max,"onUpdate:modelValue":s[3]||(s[3]=l=>e.salary_max=l),placeholder:"Max"},null,8,["modelValue"])])]),_:1})]),_:1}),t(S,{span:8},{default:o(()=>[t(D,{label:"城市"},{default:o(()=>[t(N,{modelValue:e.city_id,"onUpdate:modelValue":s[4]||(s[4]=l=>e.city_id=l),placeholder:"选择城市",style:{width:"100%"}},{default:o(()=>[(i(!0),n(p,null,h(f(w).cities,l=>(i(),c(U,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(P,{gutter:20},{default:o(()=>[t(S,{span:8},{default:o(()=>[t(D,{label:"最低经验(年)"},{default:o(()=>[t(te,{modelValue:e.min_years,"onUpdate:modelValue":s[5]||(s[5]=l=>e.min_years=l),min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),t(S,{span:8},{default:o(()=>[t(D,{label:"学历要求"},{default:o(()=>[t(N,{modelValue:e.degree_required_id,"onUpdate:modelValue":s[6]||(s[6]=l=>e.degree_required_id=l),placeholder:"学历要求",style:{width:"100%"}},{default:o(()=>[(i(!0),n(p,null,h(f(w).degrees,l=>(i(),c(U,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})])):(i(),n("div",Be,[r("div",Re,[t(g,null,{default:o(()=>[t(f(ye))]),_:1}),_(" "+d(e.city),1)]),r("div",$e,[t(g,null,{default:o(()=>[t(f(pe))]),_:1}),_(" 最低 "+d(e.min_years)+" 年经验 ",1)]),r("div",Ie,[t(g,null,{default:o(()=>[t(f(fe))]),_:1}),_(" "+d(e.degree_required),1)])]))]),t(Q),r("div",Fe,[s[15]||(s[15]=r("h3",{class:"section-title"},"必需技能",-1)),m.value?(i(),n("div",Oe,[t(N,{modelValue:e.required_skill_ids,"onUpdate:modelValue":s[7]||(s[7]=l=>e.required_skill_ids=l),multiple:"",filterable:"",placeholder:"选择技能",class:"w-full",style:{width:"100%"}},{default:o(()=>[(i(!0),n(p,null,h(f(w).skills,l=>(i(),c(U,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])):(i(),n("div",Le,[(i(!0),n(p,null,h(e.required_skills,l=>(i(),c(M,{key:l,class:"mr-2 mb-2",type:"danger",effect:"light"},{default:o(()=>[_(d(l),1)]),_:2},1024))),128)),e.required_skills?.length?V("",!0):(i(),n("span",Ae,"无"))]))]),r("div",Ge,[s[16]||(s[16]=r("h3",{class:"section-title"},"加分技能",-1)),m.value?(i(),n("div",Pe,[t(N,{modelValue:e.nice_skill_ids,"onUpdate:modelValue":s[8]||(s[8]=l=>e.nice_skill_ids=l),multiple:"",filterable:"",placeholder:"选择技能",class:"w-full",style:{width:"100%"}},{default:o(()=>[(i(!0),n(p,null,h(f(w).skills,l=>(i(),c(U,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])):(i(),n("div",Qe,[(i(!0),n(p,null,h(e.nice_to_have_skills,l=>(i(),c(M,{key:l,type:"info",class:"mr-2 mb-2"},{default:o(()=>[_(d(l),1)]),_:2},1024))),128)),e.nice_to_have_skills?.length?V("",!0):(i(),n("span",Te,"无"))]))]),t(Q),r("div",He,[s[17]||(s[17]=r("h3",{class:"section-title"},"职位描述",-1)),m.value?(i(),c(E,{key:0,modelValue:e.description,"onUpdate:modelValue":s[9]||(s[9]=l=>e.description=l),type:"textarea",rows:10,placeholder:"输入职位描述..."},null,8,["modelValue"])):(i(),n("div",Ke,d(e.description||"暂无详细描述"),1))])]),_:1})]),b.value&&I.value?(i(),n("div",We,[r("div",Xe,[s[19]||(s[19]=r("h3",null,"推荐候选人",-1)),t(k,{type:"primary",link:"",size:"small",loading:$.value,onClick:se},{default:o(()=>[...s[18]||(s[18]=[_("重新匹配",-1)])]),_:1},8,["loading"])]),ce((i(),n("div",Ye,[C.value.length?(i(),n("div",Ze,[(i(!0),n(p,null,h(C.value,l=>(i(),c(T,{key:l.resume.id,class:"match-card mb-3",shadow:"hover","body-style":{padding:"15px"}},{default:o(()=>[r("div",el,[r("div",ll,[r("div",sl,d(l.resume.candidate_name),1),r("div",tl,d(l.resume.gender)+" | "+d(l.resume.years_of_experience)+"年 | "+d(l.resume.current_level),1)]),r("div",{class:H(["score-badge",W(l.score)])},d(l.score),3)]),r("div",al,[l.llm_reason?(i(),n("div",il,d(l.llm_reason),1)):l.calculate_reason?(i(),n("div",ol,d(l.calculate_reason),1)):V("",!0)]),r("div",nl,[t(k,{type:"primary",link:"",size:"small",onClick:ul=>a.$router.push(`/resumes/${l.resume.id}`)},{default:o(()=>[s[20]||(s[20]=_(" 查看简历 ",-1)),t(g,{class:"el-icon--right"},{default:o(()=>[t(f(ke))]),_:1})]),_:1},8,["onClick"])])]),_:2},1024))),128))])):(i(),c(ie,{key:0,description:"暂无匹配候选人","image-size":"80"}))])),[[oe,R.value]])])):V("",!0)],2)])]))])}}}),cl=he(rl,[["__scopeId","data-v-152baeb6"]]);export{cl as default};
