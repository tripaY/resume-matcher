import{d as Ae,u as Ie,r as g,B as F,C as Ne,m as Be,D as Te,c as o,e as i,g as y,w as d,a as s,F as k,s as x,o as t,k as h,y as r,t as p,i as J,G as oe,z as w,b,n as Pe,p as $e,H as Fe,h as Je,A as N,I as ne,J as ie,_ as Ge}from"./index-riSBzU23.js";const Le={class:"detail-container"},qe={key:"loading",class:"loading-state"},He={key:"empty",class:"empty-state-container h-full flex items-center justify-center"},Ke={key:"content",class:"content-layout"},Oe={class:"fixed-header"},We={class:"header-content flex justify-end gap-2"},Qe={class:"scrollable-content"},Xe={class:"main-layout flex gap-4",style:{display:"flex",gap:"20px","align-items":"flex-start"}},Ye={class:"resume-section",style:{flex:"1","min-width":"0"}},Ze={class:"resume-info",style:{padding:"20px"}},el={class:"info-section flex-col",style:{display:"flex","flex-direction":"column",gap:"15px"}},ll={class:"info-row"},al={class:"value-content"},tl={key:1,class:"text-large font-bold"},sl={class:"info-row"},ol={class:"value-content avatar-section"},nl={key:0,class:"avatar-wrapper"},il={class:"upload-mask"},dl={key:1,class:"avatar-placeholder"},ul={class:"info-row"},rl={class:"value-content"},cl={key:1},_l={class:"info-row"},vl={class:"value-content"},ml={key:1},pl={class:"info-row"},yl={class:"value-content"},fl={key:1},gl={class:"info-row"},hl={class:"value-content"},kl={key:0,class:"inline-edit flex items-center",style:{"flex-wrap":"nowrap"}},xl={key:1},wl={class:"info-row"},bl={class:"value-content"},Vl={key:0,class:"salary-inputs flex items-center gap-2"},Cl={key:1},Ul={class:"skills-section"},zl={key:0},Ml={key:1,class:"min-h-20"},jl={key:0,class:"text-gray"},Dl={class:"educations-section"},Sl={class:"item-content-group"},El={class:"edu-row mb-2"},Rl={class:"w-full"},Al={key:1,class:"block text-lg mb-1"},Il={class:"edu-row flex gap-4 items-center"},Nl={class:"flex-1"},Bl={key:1,class:"block text-gray-600"},Tl={key:0,class:"text-gray-300"},Pl={class:"flex-1"},$l={key:1,class:"block text-gray-600"},Fl={class:"experiences-section"},Jl={class:"item-content-group"},Gl={class:"exp-row mb-2 flex flex-col gap-2"},Ll={class:"w-full"},ql={key:1,class:"block text-lg mb-1"},Hl={class:"w-full"},Kl={class:"exp-desc mt-2"},Ol={key:1,class:"desc whitespace-pre-wrap text-gray-600 leading-relaxed"},Wl={class:"match-dialog-content"},Ql={key:0,class:"text-xs text-gray-500 line-clamp-2"},Xl={key:1,class:"text-xs text-blue-500 mt-1"},Yl={key:2,class:"text-xs text-gray-400 mt-1 italic"},Zl={class:"pagination mt-4 flex justify-end"},ea="https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png",la=Ae({__name:"ResumeDetail",setup(aa){const G=Ne(),de=Je(),M=Ie(),B=g(!0),L=g(!1),S=g(null),V=g(null),Q=g(!1),c=g(!1),q=g(!1),H=g([]),K=g(!1),E=g(1),T=g(10),X=g(0),v=g(null),f=F(()=>({cities:M.cities||[],levels:M.levels||[],skills:M.skills||[],industries:M.industries||[],degrees:M.degrees||[]})),n=g({candidate_name:"",gender:"M",expected_city_id:null,years_of_experience:0,current_level_id:null,expected_title:"",expected_salary_min:0,expected_salary_max:0,avatar_url:"",avatar_id:null,skill_ids:[],educations:[],experiences:[]}),Y=F(()=>G.path==="/my-resume"),Z=F(()=>Y.value?!0:V.value&&v.value&&V.value.id===v.value.user_id),ue=F(()=>!(!Z.value||v.value?.id||Q.value)),P=()=>Math.random().toString(36).substr(2,9),re=a=>f.value.cities.find(e=>e.id===a)?.name,ce=a=>f.value.degrees.find(e=>e.id===a)?.name,ee=a=>f.value.industries.find(e=>e.id===a)?.name,_e=a=>a?a.map(e=>f.value.skills.find(u=>u.id===e)?.name).filter(Boolean):[],ve=a=>a>=80?"score-high":a>=60?"score-mid":"score-low",me=()=>{Q.value=!0,c.value=!0,R()},R=()=>{if(!v.value)return;const a=v.value,e=a.skills?.map(u=>{const m=f.value.skills.find(C=>C.name===u);return m?m.id:null}).filter(Boolean)||[];n.value={id:a.id,candidate_name:a.candidate_name||a.name,gender:a.gender||"M",expected_city_id:f.value.cities.find(u=>u.name===a.expected_city)?.id,years_of_experience:a.years_of_experience||a.years,current_level_id:f.value.levels.find(u=>u.name===a.current_level)?.id,expected_title:a.expected_title,expected_salary_min:a.salary_min,expected_salary_max:a.salary_max,avatar_url:a.avatar_url,avatar_id:a.avatar_id,skill_ids:e,educations:a.educations?.map(u=>({_key:P(),school:u.school,degree_id:u.degree_id||u.degree?.id,major_industry_id:u.major_industry_id||u.major_industry?.id}))||[],experiences:a.experiences?.map(u=>({_key:P(),company_name:u.company_name,industry_id:u.industry_id||u.industry?.id,description:u.description}))||[]}},le=async()=>{B.value=!0;try{const{data:{user:a}}=await x.getUser();V.value=a,f.value.cities.length||await M.fetchMeta();let e;if(Y.value){if(!a)return;e=await x.getMyResume(a.id),e.data?v.value=e.data:v.value={user_id:a.id}}else{const u=Number(G.params.id);u&&(e=await x.getResumeDetail(u),v.value=e.data)}Z.value&&R(),B.value=!1}catch(a){console.error(a),B.value=!1}},O=async()=>{if(v.value?.id){K.value=!0;try{await x.ensureMatchEvaluations(v.value.id);const{data:a,error:e}=await x.getJobsForResume(v.value.id,{page:E.value,pageSize:T.value});if(e)throw e;H.value=a.items,X.value=a.total,H.value.forEach(async u=>{if(!u.match_info.llm_score)try{const{data:m,error:C}=await x.evaluateMatch(v.value.id,u.id);!C&&m&&(u.match_info.llm_score=m.llm_score,u.match_info.llm_reason=m.llm_reason)}catch(m){console.error("AI evaluation failed for job "+u.id,m)}})}catch(a){N.error("加载匹配数据失败: "+a.message)}finally{K.value=!1}}},ae=a=>{S.value=a},pe=()=>{c.value=!1,S.value=null,R()},ye=async()=>{if(V.value){L.value=!0;try{const{error:a}=await x.saveMyResume(V.value.id,n.value);if(a)throw a;const e=await x.getMyResume(V.value.id);e.data&&(v.value=e.data),setTimeout(()=>{S.value=null,c.value=!1},0)}catch(a){N.error("保存失败: "+a.message)}finally{L.value=!1}}},fe=()=>{c.value,c.value=!0,R()},ge=()=>{q.value=!0,O()},he=a=>{T.value=a,E.value=1,O()},ke=a=>{E.value=a,O()},xe=a=>{de.push(`/jobs/${a}`)},we=()=>{const a=P();n.value.educations.push({_key:a,school:"",degree_id:null,major_industry_id:null}),ae(`edu-${a}-school`)},be=a=>{setTimeout(()=>{S.value=null},0),n.value.educations.splice(a,1)},Ve=()=>{const a=P();n.value.experiences.push({_key:a,company_name:"",industry_id:null,description:""}),ae(`exp-${a}-company`)},Ce=a=>{setTimeout(()=>{S.value=null},0),n.value.experiences.splice(a,1)},Ue=a=>a.type!=="image/jpeg"&&a.type!=="image/png"?(N.error("Avatar picture must be JPG format!"),!1):a.size/1024/1024>2?(N.error("Avatar picture size can not exceed 2MB!"),!1):!0,ze=async a=>{if(!V.value)return;const{file:e}=a;try{const{url:u,avatarId:m,error:C}=await x.uploadAvatar(V.value.id,e);if(C)throw C;n.value.avatar_url=u,n.value.avatar_id=m}catch(u){N.error("头像上传失败: "+u.message)}};return Be(()=>{le()}),Te(()=>G.path,()=>{le()}),(a,e)=>{const u=y("el-skeleton"),m=y("el-button"),C=y("el-empty"),A=y("el-input"),te=y("el-avatar"),$=y("el-icon"),Me=y("el-upload"),j=y("el-option"),D=y("el-select"),W=y("el-input-number"),I=y("el-divider"),se=y("el-tag"),je=y("el-card"),z=y("el-table-column"),De=y("el-table"),Se=y("el-pagination"),Ee=y("el-dialog"),Re=$e("loading");return t(),o("div",Le,[B.value?(t(),o("div",qe,[i(u,{rows:10,animated:""})])):ue.value?(t(),o("div",He,[i(C,{description:"您还没有简历"},{default:d(()=>[i(m,{type:"primary",size:"large",onClick:me},{default:d(()=>[...e[11]||(e[11]=[h("完善简历",-1)])]),_:1})]),_:1})])):(t(),o("div",Ke,[s("div",Oe,[s("div",We,[c.value?(t(),o(k,{key:0},[i(m,{onClick:pe},{default:d(()=>[...e[12]||(e[12]=[h("放弃编辑",-1)])]),_:1}),i(m,{type:"primary",onClick:ye,loading:L.value},{default:d(()=>[...e[13]||(e[13]=[h(" 保存 ",-1)])]),_:1},8,["loading"])],64)):(t(),o(k,{key:1},[i(m,{onClick:fe},{default:d(()=>[...e[14]||(e[14]=[h(" 去编辑 ",-1)])]),_:1}),i(m,{type:"success",onClick:ge},{default:d(()=>[...e[15]||(e[15]=[h(" 智能匹配 ",-1)])]),_:1})],64))])]),s("div",Qe,[s("div",Xe,[s("div",Ye,[i(je,{class:"box-card resume-card",shadow:"never","body-style":{padding:"0px"}},{default:d(()=>[s("div",Ze,[s("div",el,[s("div",ll,[e[16]||(e[16]=s("span",{class:"label"},"姓名:",-1)),s("div",al,[c.value?(t(),r(A,{key:0,modelValue:n.value.candidate_name,"onUpdate:modelValue":e[0]||(e[0]=l=>n.value.candidate_name=l),placeholder:"姓名"},null,8,["modelValue"])):(t(),o("span",tl,p(n.value.candidate_name||v.value?.candidate_name||"您的姓名"),1))])]),s("div",sl,[e[18]||(e[18]=s("span",{class:"label"},"头像:",-1)),s("div",ol,[c.value?(t(),r(Me,{key:0,class:"avatar-uploader",action:"#","show-file-list":!1,"http-request":ze,"before-upload":Ue},{default:d(()=>[n.value.avatar_url||v.value?.avatar_url?(t(),o("div",nl,[i(te,{size:100,src:n.value.avatar_url||v.value?.avatar_url},null,8,["src"]),s("div",il,[i($,null,{default:d(()=>[i(J(oe))]),_:1})])])):(t(),o("div",dl,[i($,{class:"avatar-uploader-icon"},{default:d(()=>[i(J(oe))]),_:1}),e[17]||(e[17]=s("span",null,"上传头像",-1))]))]),_:1})):(t(),r(te,{key:1,size:100,src:v.value?.avatar_url||ea},null,8,["src"]))])]),s("div",ul,[e[19]||(e[19]=s("span",{class:"label"},"当前职级:",-1)),s("div",rl,[c.value?(t(),r(D,{key:0,modelValue:n.value.current_level_id,"onUpdate:modelValue":e[1]||(e[1]=l=>n.value.current_level_id=l),placeholder:"当前职级",style:{width:"100%"}},{default:d(()=>[(t(!0),o(k,null,w(f.value.levels,l=>(t(),r(j,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):(t(),o("span",cl,p(v.value?.current_level||"未设置"),1))])]),s("div",_l,[e[20]||(e[20]=s("span",{class:"label"},"期望职位:",-1)),s("div",vl,[c.value?(t(),r(A,{key:0,modelValue:n.value.expected_title,"onUpdate:modelValue":e[2]||(e[2]=l=>n.value.expected_title=l),placeholder:"期望职位 (如: 前端开发工程师)"},null,8,["modelValue"])):(t(),o("span",ml,p(n.value.expected_title||v.value?.expected_title||"未设置"),1))])]),s("div",pl,[e[21]||(e[21]=s("span",{class:"label"},"期望城市:",-1)),s("div",yl,[c.value?(t(),r(D,{key:0,modelValue:n.value.expected_city_id,"onUpdate:modelValue":e[3]||(e[3]=l=>n.value.expected_city_id=l),placeholder:"期望城市",style:{width:"100%"}},{default:d(()=>[(t(!0),o(k,null,w(f.value.cities,l=>(t(),r(j,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):(t(),o("span",fl,p(re(n.value.expected_city_id)||v.value?.expected_city||"未设置"),1))])]),s("div",gl,[e[23]||(e[23]=s("span",{class:"label"},"工作经验:",-1)),s("div",hl,[c.value?(t(),o("div",kl,[i(W,{modelValue:n.value.years_of_experience,"onUpdate:modelValue":e[4]||(e[4]=l=>n.value.years_of_experience=l),min:0,"controls-position":"right",style:{width:"100%"}},null,8,["modelValue"]),e[22]||(e[22]=s("span",{class:"ml-2 whitespace-nowrap"},"年",-1))])):(t(),o("span",xl,p(n.value.years_of_experience??v.value?.years_of_experience)+" 年",1))])]),s("div",wl,[e[25]||(e[25]=s("span",{class:"label"},"期望薪资:",-1)),s("div",bl,[c.value?(t(),o("div",Vl,[i(W,{modelValue:n.value.expected_salary_min,"onUpdate:modelValue":e[5]||(e[5]=l=>n.value.expected_salary_min=l),min:0,placeholder:"Min",step:1e3,style:{width:"100%"}},null,8,["modelValue"]),e[24]||(e[24]=s("span",{class:"separator"},"-",-1)),i(W,{modelValue:n.value.expected_salary_max,"onUpdate:modelValue":e[6]||(e[6]=l=>n.value.expected_salary_max=l),min:0,placeholder:"Max",step:1e3,style:{width:"100%"}},null,8,["modelValue"])])):(t(),o("span",Cl,p(n.value.expected_salary_min??v.value?.expected_salary_min)+" - "+p(n.value.expected_salary_max??v.value?.expected_salary_max),1))])])])]),i(I,null,{default:d(()=>[...e[26]||(e[26]=[h("技能栈",-1)])]),_:1}),s("div",Ul,[c.value?(t(),o("div",zl,[i(D,{modelValue:n.value.skill_ids,"onUpdate:modelValue":e[7]||(e[7]=l=>n.value.skill_ids=l),multiple:"",filterable:"",placeholder:"选择技能",class:"w-100"},{default:d(()=>[(t(!0),o(k,null,w(f.value.skills,l=>(t(),r(j,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])):(t(),o("div",Ml,[(t(!0),o(k,null,w(_e(n.value.skill_ids),l=>(t(),r(se,{key:l,class:"mr-2 mb-2"},{default:d(()=>[h(p(l),1)]),_:2},1024))),128)),n.value.skill_ids?.length?b("",!0):(t(),o("span",jl,"暂无技能"))]))]),i(I,null,{default:d(()=>[...e[27]||(e[27]=[h("教育背景",-1)])]),_:1}),s("div",Dl,[(t(!0),o(k,null,w(n.value.educations,(l,U)=>(t(),o("div",{key:l._key||U,class:"edu-item-wrapper relative group"},[s("div",Sl,[c.value?(t(),r(m,{key:0,class:"delete-btn",type:"danger",circle:"",size:"small",onClick:ne(_=>be(U),["stop"])},{default:d(()=>[i($,null,{default:d(()=>[i(J(ie))]),_:1})]),_:1},8,["onClick"])):b("",!0),s("div",El,[s("div",Rl,[c.value?(t(),r(A,{key:0,modelValue:l.school,"onUpdate:modelValue":_=>l.school=_,placeholder:"学校名称"},null,8,["modelValue","onUpdate:modelValue"])):(t(),o("strong",Al,p(l.school||"学校名称"),1))])]),s("div",Il,[s("div",Nl,[c.value?(t(),r(D,{key:0,modelValue:l.degree_id,"onUpdate:modelValue":_=>l.degree_id=_,placeholder:"学历",size:"default",style:{width:"100%"}},{default:d(()=>[(t(!0),o(k,null,w(f.value.degrees,_=>(t(),r(j,{key:_.id,label:_.name,value:_.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue"])):(t(),o("span",Bl,p(ce(l.degree_id)||"学历"),1))]),c.value?b("",!0):(t(),o("span",Tl,"|")),s("div",Pl,[c.value?(t(),r(D,{key:0,modelValue:l.major_industry_id,"onUpdate:modelValue":_=>l.major_industry_id=_,placeholder:"专业方向",size:"default",style:{width:"100%"}},{default:d(()=>[(t(!0),o(k,null,w(f.value.industries,_=>(t(),r(j,{key:_.id,label:_.name,value:_.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue"])):(t(),o("span",$l,p(ee(l.major_industry_id)||"相关专业"),1))])])]),U<n.value.educations.length-1?(t(),r(I,{key:0,"border-style":"dashed"})):b("",!0)]))),128)),c.value?(t(),r(m,{key:0,class:"mt-4 w-100 dashed-btn",onClick:we},{default:d(()=>[...e[28]||(e[28]=[h("+ 添加教育经历",-1)])]),_:1})):b("",!0)]),i(I,null,{default:d(()=>[...e[29]||(e[29]=[h("工作经历",-1)])]),_:1}),s("div",Fl,[(t(!0),o(k,null,w(n.value.experiences,(l,U)=>(t(),o("div",{key:l._key||U,class:"exp-item-wrapper relative group"},[s("div",Jl,[c.value?(t(),r(m,{key:0,class:"delete-btn",type:"danger",circle:"",size:"small",onClick:ne(_=>Ce(U),["stop"])},{default:d(()=>[i($,null,{default:d(()=>[i(J(ie))]),_:1})]),_:1},8,["onClick"])):b("",!0),s("div",Gl,[s("div",Ll,[c.value?(t(),r(A,{key:0,modelValue:l.company_name,"onUpdate:modelValue":_=>l.company_name=_,placeholder:"公司名称",class:"mb-2"},null,8,["modelValue","onUpdate:modelValue"])):(t(),o("strong",ql,p(l.company_name||"公司名称"),1))]),s("div",Hl,[c.value?(t(),r(D,{key:0,modelValue:l.industry_id,"onUpdate:modelValue":_=>l.industry_id=_,placeholder:"行业",size:"default",style:{width:"100%"}},{default:d(()=>[(t(!0),o(k,null,w(f.value.industries,_=>(t(),r(j,{key:_.id,label:_.name,value:_.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue"])):(t(),r(se,{key:1,size:"small",type:"info"},{default:d(()=>[h(p(ee(l.industry_id)||"行业"),1)]),_:2},1024))])]),s("div",Kl,[c.value?(t(),r(A,{key:0,modelValue:l.description,"onUpdate:modelValue":_=>l.description=_,type:"textarea",rows:3,placeholder:"工作描述"},null,8,["modelValue","onUpdate:modelValue"])):(t(),o("p",Ol,p(l.description||"工作描述..."),1))])]),U<n.value.experiences.length-1?(t(),r(I,{key:0,"border-style":"dashed"})):b("",!0)]))),128)),c.value?(t(),r(m,{key:0,class:"mt-4 w-100 dashed-btn",onClick:Ve},{default:d(()=>[...e[30]||(e[30]=[h("+ 添加工作经历",-1)])]),_:1})):b("",!0)])]),_:1})])])]),i(Ee,{modelValue:q.value,"onUpdate:modelValue":e[10]||(e[10]=l=>q.value=l),title:"智能岗位匹配",width:"80%","destroy-on-close":""},{default:d(()=>[s("div",Wl,[Pe((t(),r(De,{data:H.value,stripe:""},{default:d(()=>[i(z,{prop:"id",label:"ID",width:"80"}),i(z,{prop:"title",label:"职位名称",width:"180"}),i(z,{prop:"city",label:"城市",width:"100"}),i(z,{label:"匹配度",width:"120",sortable:"",prop:"match_score"},{default:d(l=>[s("span",{class:Fe(ve(l.row.match_score))},p(l.row.match_score)+"分",3)]),_:1}),i(z,{label:"匹配分析","min-width":"200"},{default:d(l=>[l.row.match_info.calculate_reason?(t(),o("div",Ql,p(l.row.match_info.calculate_reason),1)):b("",!0),l.row.match_info.llm_score?(t(),o("div",Xl," AI: "+p(l.row.match_info.llm_score)+"分 ",1)):(t(),o("div",Yl," AI 分析中... "))]),_:1}),i(z,{label:"薪资范围",width:"150"},{default:d(l=>[h(p(l.row.salary_min)+" - "+p(l.row.salary_max),1)]),_:1}),i(z,{label:"操作",width:"100",fixed:"right"},{default:d(l=>[i(m,{type:"primary",size:"small",onClick:U=>xe(l.row.id)},{default:d(()=>[...e[31]||(e[31]=[h("详情",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Re,K.value]]),s("div",Zl,[i(Se,{"current-page":E.value,"onUpdate:currentPage":e[8]||(e[8]=l=>E.value=l),"page-size":T.value,"onUpdate:pageSize":e[9]||(e[9]=l=>T.value=l),"page-sizes":[5,10,20],total:X.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:he,onCurrentChange:ke},null,8,["current-page","page-size","total"])])])]),_:1},8,["modelValue"])]))])}}}),sa=Ge(la,[["__scopeId","data-v-5702bfed"]]);export{sa as default};
