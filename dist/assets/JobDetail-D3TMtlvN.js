import{d as ie,C as oe,u as ne,r as y,x as re,m as de,s as w,c as n,e as t,g as u,a as r,b as V,w as o,F as p,H as T,n as ue,p as _e,y as c,z as h,A as J,o as i,k as _,i as f,K as ce,t as d,L as me,M as ve,N as ye,O as pe,_ as fe}from"./index-riSBzU23.js";const ge={class:"detail-container"},ke={key:0,class:"loading-state"},he={key:1,class:"content-layout"},be={class:"fixed-header"},we={class:"header-inner"},xe={class:"header-left"},Ve={key:0,class:"header-right"},qe={class:"scrollable-content"},Ce={class:"job-section"},Me={class:"job-header-info"},Ue={class:"title-row"},Ne={key:1,class:"page-title"},De={key:2,class:"tags-row"},Se={key:0,class:"edit-meta-grid mt-4"},Je={class:"flex gap-2"},ze={key:1,class:"meta-info-grid mt-6"},Ee={class:"info-item"},$e={class:"info-item"},je={class:"info-item"},Be={class:"section-block"},Fe={key:0},Le={key:1,class:"tags-wrapper"},Oe={key:0,class:"text-gray-400"},Re={class:"section-block mt-6"},Ae={key:0},Ie={key:1,class:"tags-wrapper"},He={key:0,class:"text-gray-400"},Ke={class:"section-block"},Te={key:1,class:"desc-content whitespace-pre-wrap leading-relaxed text-gray-700"},Ge={key:0,class:"matches-sidebar"},Pe={class:"sidebar-header"},Qe={class:"match-list-container"},We={key:1,class:"match-cards"},Xe={class:"match-card-header flex justify-between items-start"},Ye={class:"candidate-basic"},Ze={class:"font-bold text-lg"},el={class:"text-xs text-gray-500 mt-1"},ll={class:"match-reasons mt-3"},sl={key:0,class:"reason-text text-xs text-gray-600 line-clamp-3"},tl={key:1,class:"reason-text text-xs text-gray-600 line-clamp-3"},al={class:"card-actions mt-3 pt-3 border-t border-gray-100 text-right"},il=ie({__name:"JobDetail",setup(ol){const G=oe(),q=Number(G.params.id),x=ne(),E=y(!0),$=y(!1),m=y(!1),b=y(!1),j=y(!1),B=y(!1),F=y(!1),P=y(null),e=re({id:0,title:"",city:"",city_id:null,level:"",level_id:null,salary_min:0,salary_max:0,min_years:0,degree_required:"",degree_required_id:null,required_skills:[],required_skill_ids:[],nice_to_have_skills:[],nice_skill_ids:[],description:""}),L=y(null),C=y([]),Q=a=>a>=80?"score-high":a>=60?"score-mid":"score-low",O=async()=>{E.value=!0;try{const a=await w.getJobDetail(q);a.data&&(L.value=JSON.parse(JSON.stringify(a.data)),R(a.data))}catch(a){console.error(a),J.error("加载岗位详情失败")}finally{E.value=!1}},R=a=>{e.id=a.id,e.title=a.title,e.city=a.city,e.city_id=a.city_id,e.level=a.level,e.level_id=a.level_id,e.salary_min=a.salary_min,e.salary_max=a.salary_max,e.min_years=a.min_years,e.degree_required=a.degree_required,e.degree_required_id=a.degree_required_id,e.required_skills=[...a.required_skills||[]],e.required_skill_ids=[...a.required_skill_ids||[]],e.nice_to_have_skills=[...a.nice_to_have_skills||[]],e.nice_skill_ids=[...a.nice_skill_ids||[]],e.description=a.description},W=()=>{m.value=!0,b.value=!1},X=()=>{m.value=!1,L.value&&R(L.value)},Y=async()=>{$.value=!0;try{const a={title:e.title,city_id:e.city_id,level_id:e.level_id,salary_min:Number(e.salary_min),salary_max:Number(e.salary_max),min_years:Number(e.min_years),degree_required_id:e.degree_required_id,required_skill_ids:e.required_skill_ids,nice_skill_ids:e.nice_skill_ids,description:e.description},{error:s}=await w.updateJob(q,a);if(s)throw s;J.success("保存成功"),m.value=!1,await O()}catch(a){console.error(a),J.error("保存失败")}finally{$.value=!1}},Z=()=>{b.value=!b.value,b.value&&C.value.length===0&&A()},A=async()=>{j.value=!0;try{const a=await w.getJobMatches(q);a.data&&(C.value=a.data,C.value.forEach(async s=>{if(s.llm_score===null||s.llm_score===void 0)try{const{data:v,error:g}=await w.evaluateMatch(s.resume.id,q);!g&&v&&v.success&&(s.llm_score=v.score,s.llm_reason=v.reason)}catch{}}))}catch(a){console.error(a)}finally{j.value=!1}},ee=async()=>{B.value=!0;try{const{data:a}=await w.getResumes({page:1,pageSize:100}),s=a.items;let v=0;for(const g of s){const{error:k}=await w.evaluateMatch(g.id,q);k||v++}J.success(`重新计算完成，处理 ${v} 份简历`),A()}catch{J.error("匹配计算失败")}finally{B.value=!1}};return de(async()=>{x.fetchMeta();const{data:{user:a}}=await w.getUser();a&&(P.value=a,a.user_metadata?.role==="admin"&&(F.value=!0)),O()}),(a,s)=>{const v=u("el-skeleton"),g=u("el-icon"),k=u("el-button"),z=u("el-input"),M=u("el-tag"),U=u("el-option"),N=u("el-select"),D=u("el-form-item"),S=u("el-col"),I=u("el-row"),le=u("el-input-number"),se=u("el-form"),H=u("el-divider"),K=u("el-card"),te=u("el-empty"),ae=_e("loading");return i(),n("div",ge,[E.value?(i(),n("div",ke,[t(v,{rows:10,animated:""})])):(i(),n("div",he,[r("div",be,[r("div",we,[r("div",xe,[t(k,{onClick:s[0]||(s[0]=l=>a.$router.back())},{default:o(()=>[t(g,{class:"mr-1"},{default:o(()=>[t(f(ce))]),_:1}),s[11]||(s[11]=_(" 返回列表 ",-1))]),_:1})]),F.value?(i(),n("div",Ve,[m.value?(i(),n(p,{key:0},[t(k,{onClick:X},{default:o(()=>[...s[12]||(s[12]=[_("放弃编辑",-1)])]),_:1}),t(k,{type:"primary",onClick:Y,loading:$.value},{default:o(()=>[...s[13]||(s[13]=[_("保存",-1)])]),_:1},8,["loading"])],64)):(i(),n(p,{key:1},[t(k,{onClick:W},{default:o(()=>[...s[14]||(s[14]=[_("编辑岗位",-1)])]),_:1}),t(k,{type:"success",onClick:Z},{default:o(()=>[_(d(b.value?"隐藏匹配":"智能匹配"),1)]),_:1})],64))])):V("",!0)])]),r("div",qe,[r("div",{class:T(["main-layout",{"has-sidebar":b.value}])},[r("div",Ce,[t(K,{class:"box-card job-card",shadow:"never"},{default:o(()=>[r("div",Me,[r("div",Ue,[m.value?(i(),c(z,{key:0,modelValue:e.title,"onUpdate:modelValue":s[1]||(s[1]=l=>e.title=l),placeholder:"职位名称",class:"title-input mb-4"},null,8,["modelValue"])):(i(),n("h1",Ne,d(e.title),1)),m.value?V("",!0):(i(),n("div",De,[t(M,{type:"success",class:"mr-2"},{default:o(()=>[_(d(e.level),1)]),_:1}),t(M,{type:"warning",effect:"plain"},{default:o(()=>[_(d(e.salary_min)+" - "+d(e.salary_max),1)]),_:1}),t(M,{type:"info",class:"ml-2"},{default:o(()=>[_(d(e.city),1)]),_:1})]))]),m.value?(i(),n("div",Se,[t(se,{"label-position":"top"},{default:o(()=>[t(I,{gutter:20},{default:o(()=>[t(S,{span:8},{default:o(()=>[t(D,{label:"职级"},{default:o(()=>[t(N,{modelValue:e.level_id,"onUpdate:modelValue":s[2]||(s[2]=l=>e.level_id=l),placeholder:"选择职级",style:{width:"100%"}},{default:o(()=>[(i(!0),n(p,null,h(f(x).levels,l=>(i(),c(U,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(S,{span:8},{default:o(()=>[t(D,{label:"薪资范围"},{default:o(()=>[r("div",Je,[t(z,{modelValue:e.salary_min,"onUpdate:modelValue":s[3]||(s[3]=l=>e.salary_min=l),placeholder:"Min"},null,8,["modelValue"]),s[15]||(s[15]=r("span",{class:"sep"},"-",-1)),t(z,{modelValue:e.salary_max,"onUpdate:modelValue":s[4]||(s[4]=l=>e.salary_max=l),placeholder:"Max"},null,8,["modelValue"])])]),_:1})]),_:1}),t(S,{span:8},{default:o(()=>[t(D,{label:"城市"},{default:o(()=>[t(N,{modelValue:e.city_id,"onUpdate:modelValue":s[5]||(s[5]=l=>e.city_id=l),placeholder:"选择城市",style:{width:"100%"}},{default:o(()=>[(i(!0),n(p,null,h(f(x).cities,l=>(i(),c(U,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(I,{gutter:20},{default:o(()=>[t(S,{span:8},{default:o(()=>[t(D,{label:"最低经验(年)"},{default:o(()=>[t(le,{modelValue:e.min_years,"onUpdate:modelValue":s[6]||(s[6]=l=>e.min_years=l),min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),t(S,{span:8},{default:o(()=>[t(D,{label:"学历要求"},{default:o(()=>[t(N,{modelValue:e.degree_required_id,"onUpdate:modelValue":s[7]||(s[7]=l=>e.degree_required_id=l),placeholder:"学历要求",style:{width:"100%"}},{default:o(()=>[(i(!0),n(p,null,h(f(x).degrees,l=>(i(),c(U,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})])):(i(),n("div",ze,[r("div",Ee,[t(g,null,{default:o(()=>[t(f(me))]),_:1}),_(" "+d(e.city),1)]),r("div",$e,[t(g,null,{default:o(()=>[t(f(ve))]),_:1}),_(" 最低 "+d(e.min_years)+" 年经验 ",1)]),r("div",je,[t(g,null,{default:o(()=>[t(f(ye))]),_:1}),_(" "+d(e.degree_required),1)])]))]),t(H),r("div",Be,[s[16]||(s[16]=r("h3",{class:"section-title"},"必需技能",-1)),m.value?(i(),n("div",Fe,[t(N,{modelValue:e.required_skill_ids,"onUpdate:modelValue":s[8]||(s[8]=l=>e.required_skill_ids=l),multiple:"",filterable:"",placeholder:"选择技能",class:"w-full",style:{width:"100%"}},{default:o(()=>[(i(!0),n(p,null,h(f(x).skills,l=>(i(),c(U,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])):(i(),n("div",Le,[(i(!0),n(p,null,h(e.required_skills,l=>(i(),c(M,{key:l,class:"mr-2 mb-2",type:"danger",effect:"light"},{default:o(()=>[_(d(l),1)]),_:2},1024))),128)),e.required_skills?.length?V("",!0):(i(),n("span",Oe,"无"))]))]),r("div",Re,[s[17]||(s[17]=r("h3",{class:"section-title"},"加分技能",-1)),m.value?(i(),n("div",Ae,[t(N,{modelValue:e.nice_skill_ids,"onUpdate:modelValue":s[9]||(s[9]=l=>e.nice_skill_ids=l),multiple:"",filterable:"",placeholder:"选择技能",class:"w-full",style:{width:"100%"}},{default:o(()=>[(i(!0),n(p,null,h(f(x).skills,l=>(i(),c(U,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])):(i(),n("div",Ie,[(i(!0),n(p,null,h(e.nice_to_have_skills,l=>(i(),c(M,{key:l,type:"info",class:"mr-2 mb-2"},{default:o(()=>[_(d(l),1)]),_:2},1024))),128)),e.nice_to_have_skills?.length?V("",!0):(i(),n("span",He,"无"))]))]),t(H),r("div",Ke,[s[18]||(s[18]=r("h3",{class:"section-title"},"职位描述",-1)),m.value?(i(),c(z,{key:0,modelValue:e.description,"onUpdate:modelValue":s[10]||(s[10]=l=>e.description=l),type:"textarea",rows:10,placeholder:"输入职位描述..."},null,8,["modelValue"])):(i(),n("div",Te,d(e.description||"暂无详细描述"),1))])]),_:1})]),b.value&&F.value?(i(),n("div",Ge,[r("div",Pe,[s[20]||(s[20]=r("h3",null,"推荐候选人",-1)),t(k,{type:"primary",link:"",size:"small",loading:B.value,onClick:ee},{default:o(()=>[...s[19]||(s[19]=[_("重新匹配",-1)])]),_:1},8,["loading"])]),ue((i(),n("div",Qe,[C.value.length?(i(),n("div",We,[(i(!0),n(p,null,h(C.value,l=>(i(),c(K,{key:l.resume.id,class:"match-card mb-3",shadow:"hover","body-style":{padding:"15px"}},{default:o(()=>[r("div",Xe,[r("div",Ye,[r("div",Ze,d(l.resume.candidate_name),1),r("div",el,d(l.resume.gender)+" | "+d(l.resume.years_of_experience)+"年 | "+d(l.resume.current_level),1)]),r("div",{class:T(["score-badge",Q(l.score)])},d(l.score),3)]),r("div",ll,[l.llm_reason?(i(),n("div",sl,d(l.llm_reason),1)):l.calculate_reason?(i(),n("div",tl,d(l.calculate_reason),1)):V("",!0)]),r("div",al,[t(k,{type:"primary",link:"",size:"small",onClick:nl=>a.$router.push(`/resumes/${l.resume.id}`)},{default:o(()=>[s[21]||(s[21]=_(" 查看简历 ",-1)),t(g,{class:"el-icon--right"},{default:o(()=>[t(f(pe))]),_:1})]),_:1},8,["onClick"])])]),_:2},1024))),128))])):(i(),c(te,{key:0,description:"暂无匹配候选人","image-size":"80"}))])),[[ae,j.value]])])):V("",!0)],2)])]))])}}}),dl=fe(il,[["__scopeId","data-v-d47b7b32"]]);export{dl as default};
